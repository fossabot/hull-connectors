{
  "name": "Intercom",
  "description": "Enrich your Leads and Contacts in Intercom and Trigger Powerful Workflows",
  "source": "intercom",
  "logo": "logo.png",
  "picture": "picture.png",
  "version": "0.1.33-monorepo",
  "tags": [
    "outgoing",
    "incoming",
    "batch",
    "batch-accounts",
    "oneColumn",
    "smart-notifier",
    "first-install",
    "single-install",
    "kraken-exports"
  ],
  "private_settings": [
    {
      "name": "oauth",
      "title": "Credentials",
      "description": "Authenticate with Intercom",
      "format": "oauth",
      "type": "string",
      "handler": "oauth",
      "url": "/auth",
      "options": {
        "name": "Intercom",
        "scope": ["refresh_token", "api"],
        "strategy": {
          "name": "Intercom",
          "scope": ["refresh_token", "api"]
        }
      }
    },
    {
      "name": "access_token",
      "title": "Access Token",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "webhook_id",
      "title": "Intercom webhook id",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "last_fetch_started_at",
      "description": "Last time fetched at operation was started",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "fetch_count",
      "description": "Count of contacts already fetched from Intercom",
      "type": "number",
      "format": "hidden"
    },
    {
      "name": "is_fetch_completed",
      "type": "boolean",
      "default": false,
      "format": "hidden"
    },
    {
      "name": "skip_users_already_synced",
      "type": "boolean",
      "default": false,
      "format": "hidden"
    },
    {
      "name": "user_claims",
      "title": "User and Lead Identity",
      "type": "array",
      "format": "table",
      "items": {
        "type": "object",
        "properties": {
          "hull": {
            "title": "Hull Identifier",
            "enum": [
              "external_id",
              "email"
            ]
          },
          "service": {
            "title": "Intercom Identifier",
            "type": "string",
            "format": "select",
            "options": {
              "allowCreate": false,
              "loadOptions": "/schema/contact_fields"
            }
          },
          "required": {
            "type": "boolean",
            "format": "select",
            "title": "required?"
          }
        }
      },
      "default": [
        {
          "hull": "external_id",
          "service": "external_id",
          "required": false
        },
        {
          "hull": "email",
          "service": "email",
          "required": false
        }
      ],
      "options": {
        "itemsPerRow": 3
      }
    },
    {
      "name": "synchronized_segments",
      "title": "User Filter",
      "description": "Send users to Intercom when belonging to one of these segments",
      "default": [],
      "type": "array",

      "format": "segment"
    },
    {
      "name": "sync_fields_to_intercom",
      "title": "Send Attributes to Intercom",
      "type": "array",
      "format": "table",
      "default": [],
      "items": {
        "type": "object",
        "properties": {
          "hull": {
            "type": "string",
            "format": "trait",
            "title": "Hull Attribute"
          },
          "name": {
            "type": "string",
            "format": "select",
            "title": "Intercom Attribute",
            "options": {
              "placeholder": "Select or create intercom attribute",
              "allowCreate": true,
              "loadOptions": "/schema/user_fields"
            }
          }
        },
        "required": [
          "hull",
          "name"
        ]
      }
    },
    {
      "name": "sync_fields_to_hull",
      "title": "Fetch custom attributes from Intercom",
      "type": "array",
      "format": "table",
      "default": [],
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "format": "select",
            "title": "Intercom Attributes",
            "options": {
              "placeholder": "Intercom Attribute",
              "loadOptions": "/schema/user_fields"
            }
          },
          "hull": {
            "type": "string",
            "format": "trait",
            "title": "Hull Attributes",
            "options": {
              "placeholder": "Hull Attribute",
              "allowCreate": true,
              "source": "intercom"
            }
          }
        },
        "required": [
          "name",
          "hull"
        ]
      }
    },
    {
      "name": "send_events",
      "title": "Sends Events to Intercom",
      "format": "event",
      "type": "array",
      "default": []
    },
    {
      "name": "mark_deleted_users",
      "title": "Mark Deleted Users",
      "description": "If a user or lead has been deleted in Intercom, mark it as such in Hull.",
      "type": "boolean",
      "default": true
    },
    {
      "name": "ignore_deleted_users",
      "title": "Ignore deleted users",
      "description": "Users tagged as deleted in Hull are marked with the attribute \"deleted_at\". Do you want to ignore sending these marked users?",
      "type": "boolean",
      "default": true
    },
    {
      "name": "account_claims",
      "title": "Company Identity",
      "type": "array",
      "format": "table",
      "items": {
        "type": "object",
        "properties": {
          "hull": {
            "title": "Hull Identifier",
            "enum": [
              "external_id",
              "domain"
            ]
          },
          "service": {
            "title": "Intercom Identifier",
            "type": "string",
            "format": "select",
            "options": {
              "allowCreate": false,
              "loadOptions": "/schema/company_fields"
            }
          },
          "required": {
            "type": "boolean",
            "format": "select",
            "title": "required?"
          }
        }
      },
      "default": [
        {
          "hull": "external_id",
          "service": "company_id",
          "required": false
        },
        {
          "hull": "domain",
          "service": "website",
          "required": false
        }
      ],
      "options": {
        "itemsPerRow": 3
      }
    },
    {
      "name": "fetch_companies",
      "title": "Company Fetch",
      "description": "Enable fetching Intercom Companies",
      "type": "boolean",
      "default": false
    },
    {
      "name": "fetch_leads",
      "title": "Lead Fetch",
      "description": "Enable fetching Intercom Leads",
      "type": "boolean",
      "default": true
    },
    {
      "name": "fetch_users",
      "title": "User Fetch",
      "description": "Enable fetching Intercom Users",
      "type": "boolean",
      "default": true
    },
    {
      "name": "incoming_account_attributes",
      "title": "Company Incoming Fields",
      "description": "List of Account fields to fetch from Salesforce",
      "type": "array",
      "format": "accountTraitMapping",
      "options": {
        "direction": "incoming",
        "showOverwriteToggle": false,
        "placeholder": "Intercom Company Field",
        "allowCreate": true,
        "loadOptions": "/schema/company_fields",
        "source": "intercom"
      },
      "default": [
        { "service": "id", "hull": "intercom/id", "readOnly": true, "overwrite": true },
        { "service": "website", "hull": "intercom/website", "readOnly": true, "overwrite": true },
        { "service": "tags", "hull": "intercom/tags", "readOnly": true, "overwrite": true },
        { "service": "segments", "hull": "intercom/segments", "readOnly": true, "overwrite": true }
      ]
    }
  ],
  "settings": [],
  "resources": [],
  "readme": "readme.md",
  "tabs": [],
  "admin": "/admin",
  "ui": false,
  "statuses": [
    {
      "url": "/status",
      "type": "interval",
      "value": "5",
      "handler": "status"
    }
  ],
  "status": {
    "initial_value": "setupRequired",
    "url": "/status",
    "type": "interval",
    "value": "5",
    "handler": "status"
  },
  "batches": [
    {
      "url": "/batch",
      "channels": [
        {
          "channel": "user:update",
          "handler": "userUpdate"
        }
      ]
    }
  ],
  "incoming": [
    {
      "url": "/intercom",
      "handler": "webhook",
      "options": {
        "credentialsFromQuery": true,
        "bodyParser": "json"
      }
    }
  ],
  "json": [
    {
      "url": "/fetchAllLeads",
      "handler": "fetchAllLeads",
      "type": "string",
      "format": "action",
      "name": "fetch_all_leads",
      "title": "Fetch All Leads",
      "options": {
        "fireAndForget": true,
        "confirm": {
          "action": "fetch",
          "text": "You are about to pull all leads from Intercom into Hull. Be careful when clicking this multiple times as it can result in long operations. Check out the \"Logs\" tab to track incoming.user.success messages as users are ingested",
          "button": "Fetch Leads",
          "entity": "users"
        }
      }
    },
    {
      "url": "/fetchAllUsers",
      "handler": "fetchAllUsers",
      "type": "string",
      "format": "action",
      "name": "fetch_all_users",
      "title": "Fetch All Users",
      "options": {
        "fireAndForget": true,
        "confirm": {
          "action": "fetch",
          "text": "You are about to pull all contacts from Intercom into Hull. Be careful when clicking this multiple times as it can result in long operations. Check out the \"Logs\" tab to track incoming.user.success messages as users are ingested",
          "button": "Fetch Contacts",
          "entity": "users"
        }
      }
    },
    {
      "url": "/fetchAllCompanies",
      "handler": "fetchAllCompanies",
      "type": "string",
      "format": "action",
      "name": "fetch_all_companies",
      "title": "Fetch All Companies",
      "options": {
        "fireAndForget": true,
        "confirm": {
          "action": "fetch",
          "text": "You are about to pull all companies from Intercom into Hull. Be careful when clicking this multiple times as it can result in long operations. Check out the \"Logs\" tab to track incoming.account.success messages as users are ingested",
          "button": "Fetch Companies",
          "entity": "users"
        }
      }
    },
    {
      "url": "/schema/user_fields",
      "handler": "fieldsInbound"
    },
    {
      "url": "/schema/company_fields",
      "handler": "companyFieldsInbound"
    },
    {
      "url": "/delete-contact",
      "handler": "deleteContact"
    },
    {
      "url": "/delete-user",
      "handler": "deleteUser"
    }
  ],
  "schedules": [
    {
      "url": "/fetch-recent-users",
      "type": "interval",
      "value": "5",
      "handler": "fetchRecentlyUpdatedUsers",
      "options": {
        "fireAndForget": true
      }
    },
    {
      "url": "/fetch-recent-leads",
      "type": "interval",
      "value": "5",
      "handler": "fetchRecentlyUpdatedLeads",
      "options": {
        "fireAndForget": true
      }
    },
    {
      "url": "/fetch-recent-companies",
      "type": "interval",
      "value": "5",
      "handler": "fetchRecentlyUpdatedCompanies",
      "options": {
        "fireAndForget": true
      }
    },
    {
      "url": "/fetch-segments",
      "type": "interval",
      "value": "60",
      "handler": "fetchSegments",
      "options": {
        "fireAndForget": true
      }
    }
  ],
  "subscriptions": [
    {
      "url": "/smart-notifier",
      "channels": [
        {
          "channel": "user:update",
          "handler": "userUpdate"
        },
        {
          "channel": "users_segment:update",
          "handler": "userSegmentUpdate"
        },
        {
          "channel": "users_segment:delete",
          "handler": "userSegmentDelete"
        }
      ],
      "conditions" : {
        "segments": {
          "user:update": ["private_settings.synchronized_segments"]
        }
      }
    }
  ],
  "settings_sections": [
    {
      "title": "Connect with Intercom",
      "description": "Please begin by authenticating this connector with Intercom.",
      "properties": [
        "private_settings.oauth"
      ]
    },
    {
      "title": "Outgoing Data",
      "step": "outgoing",
      "description": "",
      "properties": [
        "private_settings.ignore_deleted_users",
        "private_settings.synchronized_segments",
        "private_settings.sync_fields_to_intercom",
        "private_settings.send_events"
      ]
    },
    {
      "title": "User Incoming Data",
      "step": "incoming",
      "description": "Hull fetches all standard attributes from Intercom by default. If you want to capture additional custom attributes, please list them below to fetch them",
      "properties": [
        "private_settings.sync_fields_to_hull",
        "json.fetch_all_leads",
        "json.fetch_all_users"
      ]
    },
    {
      "title": "Company Identity",
      "description": "",
      "properties": [
        "private_settings.account_claims"
      ]
    },
    {
      "title": "Company Incoming Data",
      "step": "incoming",
      "description": "Fetch Companies From Intercom",
      "properties": [
        "private_settings.fetch_companies",
        "private_settings.incoming_account_attributes",
        "json.fetch_all_companies"
      ]
    }
  ]
}
