{
  "name": "Slack",
  "description": "Notify a Slack Channel whenever a User enters or leaves a Segment",
  "picture": "picture.png",
  "version": "0.0.17",
  "tags": ["incoming", "outgoing", "oneColumn", "smart-notifier"],
  "private_settings": [
    {
      "name": "oauth",
      "title": "Oauth",
      "format": "oauth",
      "type": "object",
      "handler": "oauth",
      "url": "/auth",
      "options": {
        "name": "Slack",
        "strategy": {
          "scope": ["bot", "channels:write"],
          "skipUserProfile": true
        }
      }
    },
    {
      "name": "token",
      "title": "Token",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "team_id",
      "title": "team_id",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "user_id",
      "title": "user_id",
      "type": "string",
      "format": "hidden"
    },
    {
      "name": "bot",
      "title": "Bot",
      "type": "object",
      "format": "hidden",
      "properties": {
        "bot_user_id": {
          "title": "bot_user_id",
          "type": "string"
        },
        "bot_access_token": {
          "title": "bot_access_token",
          "type": "string"
        }
      }
    },

    {
      "name": "FetchAllButton",
      "format": "actionButton",
      "type": "object",
      "properties": {
        "fetchUsers": {
          "type": "string",
          "format": "button",
          "title": "Fetch All Users",
          "options": {
            "loadOptions": "/fetch-users-link",
            "action": "call"
          }
        },
        "fetchAccounts": {
          "type": "string",
          "format": "button",
          "title": "Fetch All Accounts",
          "options": {
            "loadOptions": "/fetch-accounts-link",
            "action": "call"
          }
        }
      }
    },

    {
      "name": "notify_events",
      "title": "Add User Notification Triggers",
      "type": "array",
      "format": "table",
      "default": [
        {
          "event": "",
          "synchronized_segment": "",
          "channel": "",
          "text": "{{user.email}} did {{event.event}}"
        }
      ],
      "options": {
        "itemsPerRow": 2
      },
      "items": {
        "type": "object",
        "required": ["channel", "synchronized_segment", "event", "text"],
        "properties": {
          "event": {
            "title": "Trigger",
            "description": "Event that triggers a notification",
            "type": "string",
            "format": "event",
            "options": {
              "standard": {
                "ENTERED_USER_SEGMENT": "Entered User Segment",
                "LEFT_USER_SEGMENT": "Left User Segment"
              }
            }
          },
          "synchronized_segment": {
            "title": "Applicable User Segments",
            "description": "User segments in which user events must occur in or on",
            "type": "string",
            "format": "segment",
            "options": {
              "standard": {
                "ALL": "All Users"
              }
            },
            "default": "ALL"
          },
          "channel": {
            "title": "@user or #channel",
            "description": "Channel or slack user to notify on trigger",
            "type": "string",
            "format": "select",
            "options": {
              "loadOptions": "/fetch-destinations",
              "allowCreate": false,
              "placeholder": "Pick Channel or User"
            }
          },
          "text": {
            "title": "Message to send",
            "description": "Liquid supported. Enter the message content",
            "type": "string",
            "format": "textarea"
          }
        }
      }
    },
    {
      "name": "notify_account_events",
      "title": "Add Account Notification Triggers",
      "type": "array",
      "format": "table",
      "default": [
        {
          "event": "",
          "synchronized_segment": "",
          "channel": "",
          "text": "{{account.domain}} entered Segment"
        }
      ],
      "options": {
        "itemsPerRow": 2
      },
      "items": {
        "type": "object",
        "required": ["channel", "synchronized_segment", "event", "text"],
        "properties": {
          "event": {
            "title": "Trigger",
            "description": "Event that triggers a notification",
            "type": "string",
            "format": "select",
            "enum": ["ENTERED_ACCOUNT_SEGMENT", "LEFT_ACCOUNT_SEGMENT"],
            "enumNames": ["Entered Account Segment", "Left Account Segment"]
          },
          "synchronized_segment": {
            "title": "Applicable Account Segments",
            "description": "Target Acccount Segment",
            "type": "string",
            "format": "accountSegment",
            "options": {
              "standard": {
                "ALL": "All Accounts"
              }
            },
            "default": "ALL"
          },
          "channel": {
            "title": "@user or #channel",
            "description": "Channel or slack user to notify on trigger",
            "type": "string",
            "format": "select",
            "options": {
              "loadOptions": "/fetch-destinations",
              "allowCreate": false,
              "placeholder": "Pick Channel or User"
            }
          },
          "text": {
            "title": "Message to send",
            "description": "Liquid supported. Enter the message content",
            "type": "string",
            "format": "textarea"
          }
        }
      }
    },
    {
      "name": "attachements",
      "title": "Attachements",
      "type": "array",
      "format": "table",
      "default": [
        {
          "block_title": "",
          "attributes": []
        }
      ],
      "options": {
        "itemsPerRow": 1
      },
      "items": {
        "type": "object",
        "required": ["block_title", "attributes"],
        "properties": {
          "block_title": {
            "title": "Block Title",
            "type": "string",
            "format": "string"
          },
          "attributes": {
            "title": "Attachements",
            "type": "array",
            "format": "trait"
          }
        }
      }
    },
    {
      "name": "actions",
      "title": "Add User Update Action Buttons",
      "default": [
        {
          "label": "",
          "property": "",
          "value": ""
        }
      ],
      "type": "array",
      "format": "table",
      "items": {
        "type": "object",
        "properties": {
          "label": {
            "title": "Button Label",
            "type": "string"
          },
          "property": {
            "title": "Property name",
            "type": "string",
            "format": "trait"
          },
          "value": {
            "title": "Property Value",
            "type": "string"
          }
        }
      }
    }
  ],

  "settings_sections": [
    {
      "title": "Credentials",
      "description": "FooBar",
      "step": "credentials",
      "properties": ["private_settings.oauth"]
    },
    {
      "title": "Actions",
      "step": "actions",
      "description": "These are the actions you can perform",
      "properties": ["private_settings.actions"]
    },
    {
      "title": "Slack User Notification Triggers",
      "description": "Choose the scenarios where you would like to receive Slack notifications. \"Entered/Left User Segment\" events apply to the selected segment, whereas for other event types, the user must be IN the segment for the notification to trigger",
      "properties": ["private_settings.notify_events"]
    },
    {
      "title": "Slack Account Notification Triggers",
      "description": "Choose the scenarios where you would like to receive Slack notifications. \"Entered/Left Account Segment\" events apply to the selected segment",
      "properties": ["private_settings.notify_account_events"]
    },
    {
      "title": "Attribute Blocks",
      "description": "Define blocks with fields to attach to slack notifications. Blocks will be attached to every notification",
      "properties": ["private_settings.attachements"]
    }
  ],
  "deployment_settings": [],
  "resources": [],
  "readme": "readme.md",
  "tabs": [
    {
      "title": "Actions",
      "url": "/admin",
      "handler": "admin",
      "size": "small",
      "editable": false
    }
  ],
  "router": [
    {
      "url": "/",
      "handler": "slackWebhooks",
      "options": {}
    }
  ],
  "ui": false,
  "json": [
    {
      "url": "/fetch-destinations",
      "handler": "fetchDestination"
    }
  ],
  "status": {
    "url": "/status",
    "handler": "status",
    "type": "interval",
    "value": "5"
  },
  "statuses": [
    {
      "url": "/status",
      "handler": "status",
      "type": "interval",
      "value": "5"
    }
  ],
  "subscriptions": [
    {
      "url": "/smart-notify",
      "conditions": {
        "channels": {
          "only": ["user:update", "account:update", "ship:update"]
        }
      },
      "channels": [
        {
          "channel": "account:update",
          "handler": "accountUpdate"
        },
        {
          "channel": "user:update",
          "handler": "userUpdate"
        },
        {
          "channel": "ship:update",
          "handler": "shipUpdate"
        }
      ]
    }
  ]
}
